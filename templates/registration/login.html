{% extends 'registration/auth_base.html' %}
{% load static %}

{% block title %}Iniciar Sesión - CRM UNAD{% endblock %}

{% block content %}
<div class="text-center mb-4">
    <div class="auth-logo">
        <i class="fas fa-users fa-3x text-primary mb-3"></i>
        <h2 class="auth-title">CRM UNAD</h2>
        <p class="text-muted">Sistema de Gestión de Relaciones con Clientes</p>
    </div>
</div>

<form method="post" class="auth-form">
    {% csrf_token %}
    
    {% if form.errors %}
        <div class="alert alert-danger" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i>
            {% for field, errors in form.errors.items %}
                {% for error in errors %}
                    {{ error }}<br>
                {% endfor %}
            {% endfor %}
        </div>
    {% endif %}
    
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                <i class="fas fa-info-circle me-2"></i>
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        {% endfor %}
    {% endif %}
    
    <div class="mb-3">
        <label for="{{ form.username.id_for_label }}" class="form-label">
            <i class="fas fa-user me-2"></i>Usuario
        </label>
        <input type="text" 
               class="form-control form-control-lg" 
               id="{{ form.username.id_for_label }}"
               name="{{ form.username.name }}"
               placeholder="Ingresa tu usuario"
               value="{{ form.username.value|default:'' }}"
               required>
    </div>
    
    <div class="mb-4">
        <label for="{{ form.password.id_for_label }}" class="form-label">
            <i class="fas fa-lock me-2"></i>Contraseña
        </label>
        <div class="position-relative">
            <input type="password" 
                   class="form-control form-control-lg" 
                   id="{{ form.password.id_for_label }}"
                   name="{{ form.password.name }}"
                   placeholder="Ingresa tu contraseña"
                   required>
            <button type="button" class="btn btn-link position-absolute end-0 top-50 translate-middle-y me-2" 
                    id="togglePassword" style="z-index: 10;">
                <i class="fas fa-eye" id="eyeIcon"></i>
            </button>
        </div>
    </div>
    
    <div class="mb-3 form-check">
        <input type="checkbox" class="form-check-input" id="rememberMe" name="remember_me">
        <label class="form-check-label" for="rememberMe">
            Recordarme
        </label>
    </div>
    
    <div class="d-grid mb-3">
        <button type="submit" class="btn btn-primary btn-lg">
            <i class="fas fa-sign-in-alt me-2"></i>Iniciar Sesión
        </button>
    </div>
    
    <div class="text-center">
        <a href="{% url 'password_reset' %}" class="text-decoration-none">
            <i class="fas fa-key me-1"></i>¿Olvidaste tu contraseña?
        </a>
    </div>
</form>

<div class="auth-footer text-center mt-4">
    <small class="text-muted">
        <i class="fas fa-university me-1"></i>
        Universidad Nacional Abierta y a Distancia - UNAD
    </small>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Toggle password visibility
    $('#togglePassword').on('click', function() {
        const passwordField = $('#{{ form.password.id_for_label }}');
        const eyeIcon = $('#eyeIcon');
        
        if (passwordField.attr('type') === 'password') {
            passwordField.attr('type', 'text');
            eyeIcon.removeClass('fa-eye').addClass('fa-eye-slash');
        } else {
            passwordField.attr('type', 'password');
            eyeIcon.removeClass('fa-eye-slash').addClass('fa-eye');
        }
    });
    
    // Auto-focus on username field
    $('#{{ form.username.id_for_label }}').focus();
    
    // Form submission loading state
    $('.auth-form').on('submit', function() {
        const submitBtn = $(this).find('button[type="submit"]');
        submitBtn.html('<i class="fas fa-spinner fa-spin me-2"></i>Iniciando sesión...');
        submitBtn.prop('disabled', true);
    });
    
    // Remember me functionality
    if (localStorage.getItem('rememberUsername')) {
        $('#{{ form.username.id_for_label }}').val(localStorage.getItem('rememberUsername'));
        $('#rememberMe').prop('checked', true);
    }
    
    $('#rememberMe').on('change', function() {
        if ($(this).is(':checked')) {
            localStorage.setItem('rememberUsername', $('#{{ form.username.id_for_label }}').val());
        } else {
            localStorage.removeItem('rememberUsername');
        }
    });
    
    $('#{{ form.username.id_for_label }}').on('blur', function() {
        if ($('#rememberMe').is(':checked')) {
            localStorage.setItem('rememberUsername', $(this).val());
        }
    });
});
</script>
{% endblock %}